_format_version: "3.0"
_konnect:
  control_plane_name: Kong-Demo

services:
  # Demo API Service
  - name: demo-api-service
    url: http://host.docker.internal:3000
    tags:
      - demo-api
    routes:
      - name: demo-api-route
        paths:
          - /api/demo
        strip_path: true
        tags:
          - demo

  # AI Router Service
  - name: ai-router-service
    url: http://host.docker.internal:8080
    tags:
      - ai-router
    routes:
      - name: ai-router-route
        paths:
          - /ai
        strip_path: true
        tags:
          - ai

# Consumers
consumers:
  - username: demo-user
    custom_id: user-001
    tags:
      - demo
    keyauth_credentials:
      - key: demo-api-key-12345

  - username: power-user
    custom_id: user-002
    tags:
      - premium
    keyauth_credentials:
      - key: power-key-67890

# Plugins
plugins:
  # Key Authentication for Demo API
  - name: key-auth
    route: demo-api-route
    config:
      key_names:
        - apikey
      hide_credentials: true

  # Key Authentication for AI Router
  - name: key-auth
    route: ai-router-route
    config:
      key_names:
        - apikey
      hide_credentials: true

  # Rate Limiting for demo-user
  - name: rate-limiting
    consumer: demo-user
    config:
      minute: 10
      hour: 100
      policy: local
      fault_tolerant: true

  # Rate Limiting for power-user
  - name: rate-limiting
    consumer: power-user
    config:
      minute: 50
      hour: 500
      policy: local
      fault_tolerant: true

  # Correlation ID
  - name: correlation-id
    config:
      header_name: X-Request-ID
      generator: uuid
      echo_downstream: true
